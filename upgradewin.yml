---
- name: Update and Reboot Windows Servers
  hosts: all
  tasks:
  - name: Ensure common OS updates are current
    win_updates:
      register: update_result
  
  - name: Install all security, critical, and rollup updates
    win_updates:
      category_names:
        - SecurityUpdates
        - CriticalUpdates
        - UpdateRollups
      state: installed
      register: update_result

  - name: Reboot host if required
    win_reboot:
    when: update_result.reboot_required
